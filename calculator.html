<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cost Estimator | Logikos.in</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>
</head>
<body>
    <nav><div class="logo">LOGIKOS.IN</div><ul><li><a href="index.html">Home</a></li><li><a href="services.html">Services</a></li><li><a href="shop.html">Shop</a></li><li><a href="calculator.html">Cost Estimator</a></li></ul></nav>

    <div class="container" style="max-width: 600px;">
        <h2>3D Printing Cost Estimator</h2>
        <div class="card">
            <label>1. Select Material:</label>
            <select id="material" class="file-input" style="margin-bottom: 20px;">
                <option value="1.24">PLA (1.24g/cm³)</option>
                <option value="1.04">ABS (1.04g/cm³)</option>
                <option value="1.27">PETG (1.27g/cm³)</option>
                <option value="1.20">Nylon (1.20g/cm³)</option>
                <option value="1.10">TPU (1.10g/cm³)</option>
            </select>

            <label>2. Upload STL File:</label>
            <input type="file" id="stl_file" accept=".stl" class="file-input" />
            
            <div id="loader" style="display:none; margin-top:10px; color:#007bff;">Processing Mesh...</div>
            
            <div id="result-card" style="display:none; margin-top:20px; border-top:1px solid #eee; padding-top:20px;">
                <p><strong>Volume:</strong> <span id="volume">0</span> mm³</p>
                <p><strong>Estimated Weight:</strong> <span id="weight">0</span> g</p>
                <h3 style="color: #28a745;">Estimated Cost: ₹<span id="price">0</span></h3>
            </div>
        </div>
    </div>

    <script>
        const pricePerGram = 7; // Set your base price per gram here (INR)

        document.getElementById('stl_file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(!file) return;

            document.getElementById('loader').style.display = 'block';
            const reader = new FileReader();
            
            reader.onload = function() {
                const loader = new THREE.STLLoader();
                const geometry = loader.parse(this.result);
                const volume = calculateVolume(geometry); 
                
                const density = parseFloat(document.getElementById('material').value);
                const weightGrams = (volume / 1000) * density;
                const totalPrice = weightGrams * pricePerGram;

                document.getElementById('volume').innerText = Math.round(volume);
                document.getElementById('weight').innerText = weightGrams.toFixed(2);
                document.getElementById('price').innerText = totalPrice.toFixed(2);
                
                document.getElementById('loader').style.display = 'none';
                document.getElementById('result-card').style.display = 'block';
            };
            reader.readAsArrayBuffer(file);
        });

        function calculateVolume(geometry) {
            let volume = 0;
            const pos = geometry.attributes.position.array;
            for (let i = 0; i < pos.length; i += 9) {
                let v1 = {x:pos[i], y:pos[i+1], z:pos[i+2]};
                let v2 = {x:pos[i+3], y:pos[i+4], z:pos[i+5]};
                let v3 = {x:pos[i+6], y:pos[i+7], z:pos[i+8]};
                volume += (-v3.x*v2.y*v1.z + v2.x*v3.y*v1.z + v3.x*v1.y*v2.z - v1.x*v3.y*v2.z - v2.x*v1.y*v3.z + v1.x*v2.y*v3.z) / 6;
            }
            return Math.abs(volume);
        }
    </script>
</body>
</html>
