<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logikos | Strategic Survey</title>
    <link rel="stylesheet" href="../style.css"> 
    <style>
        /* --- LOGIKOS SURVEY THEME OVERRIDES --- */
        html, body {
            height: 100%;
            margin: 0;
            background: #ffffff; /* Overriding f9f9f9 for clean look */
        }

        .survey-hero-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 140px); /* Matches your home page calc */
            text-align: center;
            padding: 20px;
        }

        /* Welcome Note Center Aligned */
        h1 { font-size: 2.5rem; letter-spacing: 2px; margin-bottom: 10px; }
        .welcome-desc { max-width: 600px; color: #555; margin-bottom: 30px; font-size: 1.1rem; }

        /* The "Logikos Style" Input Box (Half Width + Black Border) */
        .survey-input {
            width: 50%;
            max-width: 400px;
            padding: 15px;
            border: 2px solid #000000; /* Distinct Black Border */
            border-radius: 4px;
            font-size: 1.1rem;
            margin-top: 10px;
            outline: none;
            box-sizing: border-box;
        }

        /* Question Bundle Styling (Tight options, spaced questions) */
        .question-block { margin-bottom: 40px; text-align: left; width: 100%; max-width: 600px; }
        .q-text { font-weight: bold; font-size: 1.1rem; display: block; margin-bottom: 8px; }
        
        .option-row { 
            display: flex; 
            align-items: center; 
            margin-bottom: 8px; /* Tight bundle */
            cursor: pointer; 
        }
        .option-row input { margin-right: 12px; width: 18px; height: 18px; accent-color: #000; }

        /* Navigation Buttons (Following your btn-box theme) */
        .nav-btns { margin-top: 40px; display: flex; gap: 20px; }
        .btn-logikos {
            padding: 12px 35px;
            border: 2px solid #1a1a1a;
            background: #ffffff;
            color: #1a1a1a;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.1s ease;
        }
        .btn-logikos:hover { background: #f8f8f8; }
        .btn-logikos:active { transform: translateY(2px); background: #eee; }

        /* Bubble Pool (List1) */
        .selection-area { border: 2px dashed #ccc; padding: 10px; margin-bottom: 10px; min-height: 40px; border-radius: 4px; display: flex; flex-wrap: wrap; gap: 5px; }
        .selected-bubble { background: #000; color: #fff; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; }
        .options-pool { display: flex; flex-wrap: wrap; gap: 8px; }
        .bubble-option { border: 1px solid #000; padding: 5px 12px; border-radius: 20px; cursor: pointer; font-size: 0.8rem; }

        /* Footer Sync */
        footer { background: #000; color: white; padding: 20px; text-align: center; font-size: 12px; }
    </style>
</head>
<body>

    <nav>
        <div class="logo">LOGIKOS</div>
        <span></span> 
    </nav>

    <main class="survey-hero-wrapper" id="surveyContainer">
        </main>

    <footer>
        &copy; 2026 LOGIKOS.IN | SIMPLE IS SENSIBLE | AHMEDABAD
    </footer>

    <script src="engine.js"></script>
    <script>
        // GOOGLE SHEETS CONFIG
        const GOOGLE_SCRIPT_URL = 'YOUR_APPS_SCRIPT_URL_HERE';

        class SurveyEngine {
            constructor(data) {
                this.data = data;
                this.currentPageId = "p1";
                this.responses = {};
                this.history = [];
                this.selectedBranch = null;
            }

            init() { this.renderPage(); }

            renderPage() {
                const container = document.getElementById('surveyContainer');
                container.innerHTML = '';
                const page = this.data.pages.find(p => p.id === this.currentPageId);

                const h1 = document.createElement('h1');
                h1.innerText = page.pageName;
                container.appendChild(h1);

                page.questions.forEach(q => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'question-block';
                    if(this.currentPageId === 'p1') wrapper.style.textAlign = 'center';

                    if (q.type === 'InfoBox') {
                        const p = document.createElement('p');
                        p.className = 'welcome-desc';
                        p.innerText = q.content;
                        wrapper.appendChild(p);
                    } else {
                        const label = document.createElement('label');
                        label.className = 'q-text';
                        label.innerText = q.label;
                        wrapper.appendChild(label);
                        
                        if (q.type === 'DESQ') this.buildDESQ(q, wrapper);
                        else if (q.type === 'MCQ_1' || q.type === 'MCQ_Logic') this.buildMCQ(q, wrapper, false);
                        else if (q.type === 'MCQ_Multi') this.buildMCQ(q, wrapper, true);
                        else if (q.type === 'List1') this.buildList1(q, wrapper);
                    }
                    container.appendChild(wrapper);
                });

                this.renderNav(page, container);
            }

            buildDESQ(q, w) {
                const i = document.createElement('input');
                i.type = q.inputType || 'text';
                i.className = 'survey-input';
                i.value = this.responses[q.id] || '';
                i.oninput = (e) => this.responses[q.id] = e.target.value;
                w.appendChild(i);
            }

            buildMCQ(q, w, isMulti) {
                q.options.forEach(opt => {
                    const r = document.createElement('label');
                    r.className = 'option-row';
                    const checked = isMulti ? (this.responses[q.id] || []).includes(opt) : this.responses[q.id] === opt;
                    r.innerHTML = `<input type="${isMulti?'checkbox':'radio'}" name="${q.id}" ${checked?'checked':''}> ${opt}`;
                    r.querySelector('input').onchange = (e) => {
                        if (!isMulti) {
                            this.responses[q.id] = opt;
                            if(q.type === 'MCQ_Logic') this.selectedBranch = q.logic_map[opt];
                        } else {
                            if(!this.responses[q.id]) this.responses[q.id] = [];
                            e.target.checked ? this.responses[q.id].push(opt) : this.responses[q.id] = this.responses[q.id].filter(i => i !== opt);
                        }
                    };
                    w.appendChild(r);
                });
            }

            buildList1(q, w) {
                const area = document.createElement('div'); area.className = 'selection-area';
                const pool = document.createElement('div'); pool.className = 'options-pool';
                const refresh = () => {
                    area.innerHTML = '';
                    (this.responses[q.id] || []).forEach(val => {
                        const b = document.createElement('div'); b.className = 'selected-bubble';
                        b.innerHTML = `${val}`;
                        area.appendChild(b);
                    });
                };
                q.options.forEach(opt => {
                    const b = document.createElement('div'); b.className = 'bubble-option'; b.innerText = opt;
                    b.onclick = () => {
                        if(!this.responses[q.id]) this.responses[q.id] = [];
                        if(!this.responses[q.id].includes(opt)) { this.responses[q.id].push(opt); refresh(); }
                    };
                    pool.appendChild(b);
                });
                w.appendChild(area); w.appendChild(pool); refresh();
            }

            renderNav(page, container) {
                const nav = document.createElement('div');
                nav.className = 'nav-btns';
                
                if (this.history.length > 0) {
                    const b = document.createElement('button'); b.className = 'btn-logikos'; b.innerText = "BACK";
                    b.onclick = () => { this.currentPageId = this.history.pop(); this.renderPage(); };
                    nav.appendChild(b);
                }

                const n = document.createElement('button'); 
                n.className = 'btn-logikos'; 
                n.innerText = page.id.startsWith('BRANCH') ? "SUBMIT" : "NEXT";
                n.onclick = () => {
                    if (page.id === 'p1' && (!this.responses['email'] || !this.responses['email'].includes('@'))) {
                        alert("Please enter a valid email."); return;
                    }
                    if (page.id.startsWith('BRANCH')) {
                        this.submitToGoogle();
                    } else {
                        this.history.push(this.currentPageId);
                        this.currentPageId = (this.currentPageId === 'p3' && this.selectedBranch) ? this.selectedBranch : page.nextPage;
                        this.renderPage();
                    }
                };
                nav.appendChild(n);
                container.appendChild(nav);
            }

            async submitToGoogle() {
                const payload = {};
                for (const key in this.responses) {
                    payload[key] = Array.isArray(this.responses[key]) ? this.responses[key].join(', ') : this.responses[key];
                }
                
                document.getElementById('surveyContainer').innerHTML = "<h1>SYNCING...</h1>";
                
                try {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify(payload)
                    });
                    document.getElementById('surveyContainer').innerHTML = "<h1>THANK YOU</h1><p>Data synced to Google Sheets.</p>";
                } catch (e) {
                    alert("Submission failed. Check console.");
                }
            }
        }

        // Fetch local survey.json and init
        fetch('./survey.json').then(res => res.json()).then(data => {
            new SurveyEngine(data).init();
        });
    </script>
</body>
</html>
